# Template file for 'rust-sccache'
pkgname=rust-sccache
version=0.2.15
revision=1
wrksrc="${pkgname/rust-/}-${version}"
build_style=cargo
# test_rust_cargo: tests/test-crate directory exists in v0.2.15 tag on github,
# but is strangely missing from v0.2.15 on crates.io
make_check_args="-- --skip test_rust_cargo"
hostmakedepends="pkg-config"
makedepends="openssl-devel"
checkdepends="cargo"
short_desc="Ccache-like tool for Rust, C/C++ & more"
maintainer="Enno Boland <gottox@voidlinux.org>"
license="Apache-2.0"
homepage="https://crates.io/crates/sccache"
distfiles="https://static.crates.io/crates/sccache/sccache-${version}.crate"
checksum=cd1b19d56224beccdbf3fcc1fac1b21d58ddad64eed7fc1288db84d227bcebf7

case "$XBPS_TARGET_MACHINE" in
	x86_64*) configure_args+=" --features dist-server" ;;
	i686*|arm*|aarch64*) ;;
	*) broken="ftbfs in ring" ;;
esac

# test_sccache_command will fail if gcc/clang is actually a ccache wrapper
# requires fixing in upstream
if [ -n "$XBPS_CCACHE" ]; then
	make_check_args+=" --skip test_sccache_command"
fi
